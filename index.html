<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MINDYN 价格查询系统 (CN版)</title>
    
    <!-- 
      === 核心修复 ===
      恢复使用 cdn.tailwindcss.com。
      注意：这是单文件运行所必须的“即时编译”版本。普通的 tailwind.js 静态文件无法在浏览器中工作，会导致 UI 失效。
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 其他核心库保持国内镜像 (Staticfile/七牛云)，确保加载速度 -->
    <script src="https://cdn.staticfile.org/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdn.staticfile.org/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.staticfile.org/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.staticfile.org/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Tailwind 配置: 适配中文字体 -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              // 针对中国大陆用户优化：优先使用 苹方、微软雅黑
              sans: ['"PingFang SC"', '"Microsoft YaHei"', '"Heiti SC"', 'Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
              mono: ['"JetBrains Mono"', 'Consolas', 'Monaco', '"Courier New"', 'monospace'],
            },
            colors: {
              tech: {
                50: '#f0fdfa',
                100: '#ccfbf1',
                200: '#99f6e4',
                300: '#5eead4',
                400: '#2dd4bf',
                500: '#14b8a6',
                600: '#0d9488',
                700: '#0f766e',
                800: '#115e59',
                900: '#0f172a',
                accent: '#06b6d4',
              }
            }
          }
        }
      }
    </script>
    <style>
      body { background-color: #0f172a; color: #e2e8f0; }
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #1e293b; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #475569; }
      .loading-container {
        display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: #06b6d4; font-family: 'JetBrains Mono', monospace;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "xlsx": "https://esm.sh/xlsx@^0.18.5",
    "lucide-react": "https://esm.sh/lucide-react@^0.561.0"
  }
}
</script>
</head>
<body>
    <div id="root">
      <div class="loading-container">
        <div class="animate-pulse text-xl tracking-[0.3em] font-bold">正在初始化系统...</div>
        <div class="text-xs text-slate-500 mt-4 font-sans">MINDYN V1.5 CN_RESTORED</div>
      </div>
    </div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // --- 1. 内置图标组件 (保持内联，无需外部请求，速度最快且不依赖网络) ---
      const Icon = ({ children, className, ...props }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
      );
      
      const Zap = (p) => <Icon {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></Icon>;
      const Database = (p) => <Icon {...p}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></Icon>;
      const Search = (p) => <Icon {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></Icon>;
      const LayoutGrid = (p) => <Icon {...p}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></Icon>;
      const PlusCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></Icon>;
      const Settings = (p) => <Icon {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>;
      const Upload = (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></Icon>;
      const FileSpreadsheet = (p) => <Icon {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M8 13h2"/><path d="M8 17h2"/><path d="M14 13h2"/><path d="M14 17h2"/></Icon>;
      const Loader2 = (p) => <Icon {...p}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></Icon>;
      const X = (p) => <Icon {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
      const ChevronRight = (p) => <Icon {...p}><path d="m9 18 6-6-6-6"/></Icon>;
      const Tag = (p) => <Icon {...p}><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></Icon>;
      const Truck = (p) => <Icon {...p}><path d="M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11"/><path d="M14 9h4l4 4v4c0 .6-.4 1-1 1h-2"/><circle cx="7" cy="18" r="2"/><path d="M15 18H9"/><circle cx="17" cy="18" r="2"/></Icon>;
      const AlertCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></Icon>;
      const DollarSign = (p) => <Icon {...p}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></Icon>;
      const Clock = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></Icon>;
      const Briefcase = (p) => <Icon {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></Icon>;
      const LinkIcon = (p) => <Icon {...p}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></Icon>;
      const BoxSelect = (p) => <Icon {...p}><path d="M5 3a2 2 0 0 0-2 2"/><path d="M19 3a2 2 0 0 1 2 2"/><path d="M21 19a2 2 0 0 1-2 2"/><path d="M5 21a2 2 0 0 1-2-2"/><path d="M9 3h1"/><path d="M9 21h1"/><path d="M14 3h1"/><path d="M14 21h1"/><path d="M3 9v1"/><path d="M21 9v1"/><path d="M3 14v1"/><path d="M21 14v1"/></Icon>;
      const Trash2 = (p) => <Icon {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>;
      const Image = (p) => <Icon {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></Icon>;
      const Edit = (p) => <Icon {...p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></Icon>;
      const Edit2 = (p) => <Icon {...p}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></Icon>;
      const Plus = (p) => <Icon {...p}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>;
      const Save = (p) => <Icon {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;

      // --- 2. 服务层: Excel 解析 ---
      const parseExcelFile = (file) => {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = e.target?.result;
              if (!data) return;
              const workbook = XLSX.read(data, { type: 'binary' });
              const sheetName = workbook.SheetNames[0];
              const sheet = workbook.Sheets[sheetName];
              const jsonData = XLSX.utils.sheet_to_json(sheet);

              const mappedData = jsonData.map((item, index) => ({
                id: item['序号'] || item['ID'] || index + 1,
                name: item['产品名称'] || item['Name'] || 'Unknown Product',
                price: item['价格'] || item['Price'] || 'N/A',
                shippingList: item['发货清单'] || item['Shipping List'] || '',
                rentalPrice: item['租赁价格'] || item['Rental Price'] || '',
                notes: item['注意事项'] || item['Notes'] || '',
                imageUrl: item['产品图片'] || item['Image'] || '',
                parameters: item['产品参数'] || item['Parameters'] || '',
                leadTime: item['工期'] || item['Lead Time'] || '',
                customerPrep: item['需自备'] || item['Customer Prep'] || '',
                caseReference: item['案例参考'] || item['Case Reference'] || '',
                applicableOccasions: item['适用场合'] || item['Occasions'] || '',
              }));
              resolve(mappedData);
            } catch (error) { reject(error); }
          };
          reader.onerror = (error) => reject(error);
          reader.readAsBinaryString(file);
        });
      };

      // --- 3. 组件: FileUpload ---
      const FileUpload = ({ onDataLoaded }) => {
        const fileInputRef = useRef(null);
        const [isDragging, setIsDragging] = useState(false);
        const [isLoading, setIsLoading] = useState(false);
        const [fileName, setFileName] = useState(null);

        const handleFile = async (file) => {
          setIsLoading(true);
          setFileName(file.name);
          try {
            const data = await parseExcelFile(file);
            setTimeout(() => {
              onDataLoaded(data);
              setIsLoading(false);
            }, 800);
          } catch (error) {
            console.error("Error parsing excel:", error);
            alert("Excel 解析失败，请检查文件格式。");
            setIsLoading(false);
            setFileName(null);
          }
        };

        return (
          <div className="w-full">
            <div
              onClick={() => fileInputRef.current?.click()}
              onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}
              onDragLeave={() => setIsDragging(false)}
              onDrop={(e) => {
                e.preventDefault();
                setIsDragging(false);
                if (e.dataTransfer.files && e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
              }}
              className={`
                relative group cursor-pointer 
                border-2 border-dashed rounded-xl p-6
                transition-all duration-300 ease-in-out
                flex flex-col items-center justify-center text-center
                ${isDragging 
                  ? 'border-tech-accent bg-tech-accent/10 shadow-[0_0_30px_rgba(6,182,212,0.2)]' 
                  : 'border-slate-700 hover:border-tech-accent/50 hover:bg-slate-800/50 bg-slate-900/50'
                }
              `}
            >
              <input type="file" ref={fileInputRef} onChange={(e) => e.target.files && handleFile(e.target.files[0])} accept=".xlsx, .xls" className="hidden" />
              {isLoading ? (
                <div className="flex flex-col items-center text-tech-accent animate-pulse">
                  <Loader2 className="w-8 h-8 animate-spin mb-2" />
                  <span className="font-mono text-sm tracking-widest">数据处理中...</span>
                </div>
              ) : fileName ? (
                 <div className="flex flex-col items-center text-tech-accent">
                  <FileSpreadsheet className="w-8 h-8 mb-2" />
                  <span className="font-medium text-slate-200">{fileName}</span>
                  <span className="text-xs text-slate-400 mt-1">点击更换文件</span>
                </div>
              ) : (
                <>
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center mb-3 transition-all duration-300 ${isDragging ? 'bg-tech-accent text-slate-900' : 'bg-slate-800 text-slate-400 group-hover:text-tech-accent'}`}>
                    <Upload className="w-5 h-5" />
                  </div>
                  <h3 className="text-slate-200 font-medium mb-1">导入 Excel 数据矩阵</h3>
                  <p className="text-slate-500 text-xs font-mono">支持 .XLSX / .XLS 格式</p>
                </>
              )}
            </div>
          </div>
        );
      };

      // --- 4. 组件: SearchBar ---
      const SearchBar = ({ products, onProductSelect }) => {
        const [query, setQuery] = useState('');
        const [results, setResults] = useState([]);
        const [isOpen, setIsOpen] = useState(false);
        const wrapperRef = useRef(null);

        useEffect(() => {
          function handleClickOutside(event) {
            if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {
              setIsOpen(false);
            }
          }
          document.addEventListener("mousedown", handleClickOutside);
          return () => document.removeEventListener("mousedown", handleClickOutside);
        }, [wrapperRef]);

        const handleSearch = (text) => {
          setQuery(text);
          if (text.trim().length > 0) {
            const filtered = products.filter(p => 
              p.name.toLowerCase().includes(text.toLowerCase()) || String(p.id).includes(text)
            ).slice(0, 8);
            setResults(filtered);
            setIsOpen(true);
          } else {
            setResults([]);
            setIsOpen(false);
          }
        };

        const handleSelect = (product) => {
          onProductSelect(product);
          setQuery(product.name);
          setIsOpen(false);
        };

        return (
          <div ref={wrapperRef} className="w-full max-w-2xl relative z-50">
            <div className="relative group">
              <div className="absolute inset-0 bg-gradient-to-r from-tech-accent to-blue-600 rounded-xl blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
              <div className="relative flex items-center bg-slate-900 border border-slate-700 rounded-xl shadow-2xl p-1 focus-within:border-tech-accent transition-colors">
                <div className="pl-4 pr-3 text-slate-400"><Search className="w-6 h-6" /></div>
                <input
                  type="text"
                  className="w-full bg-transparent text-white text-lg placeholder-slate-500 border-none outline-none py-3"
                  placeholder="输入产品名称或序号进行搜索..."
                  value={query}
                  onChange={(e) => handleSearch(e.target.value)}
                  onFocus={() => query.length > 0 && setIsOpen(true)}
                />
                {query && (
                  <button onClick={() => { setQuery(''); setIsOpen(false); }} className="p-2 text-slate-500 hover:text-white transition-colors">
                    <X className="w-5 h-5" />
                  </button>
                )}
              </div>
            </div>
            {isOpen && results.length > 0 && (
              <div className="absolute top-full left-0 right-0 mt-2 bg-slate-900/95 backdrop-blur-xl border border-slate-700 rounded-xl overflow-hidden shadow-2xl animate-in fade-in zoom-in-95 duration-200">
                <ul className="divide-y divide-slate-800">
                  {results.map((product) => (
                    <li key={product.id} onClick={() => handleSelect(product)} className="p-4 cursor-pointer hover:bg-tech-accent/10 hover:pl-6 transition-all duration-200 group flex items-center justify-between">
                      <div className="flex flex-col">
                        <span className="text-slate-200 font-medium group-hover:text-tech-accent transition-colors">{product.name}</span>
                        <span className="text-xs font-mono text-slate-500 mt-1">ID: {product.id} • 价格: {product.price}</span>
                      </div>
                      <ChevronRight className="w-4 h-4 text-slate-600 group-hover:text-tech-accent opacity-0 group-hover:opacity-100 transition-all" />
                    </li>
                  ))}
                </ul>
                <div className="bg-slate-950 p-2 text-center text-[10px] text-slate-600 font-mono tracking-widest uppercase">已找到 {results.length} 条匹配</div>
              </div>
            )}
            {isOpen && query.length > 0 && results.length === 0 && (
              <div className="absolute top-full left-0 right-0 mt-2 bg-slate-900 border border-slate-700 rounded-xl p-4 text-center shadow-2xl">
                <p className="text-slate-400 text-sm">未找到匹配的系统数据。</p>
              </div>
            )}
          </div>
        );
      };

      // --- 5. 组件: ProductDetail ---
      const ProductDetail = ({ product }) => {
        return (
          <div className="w-full max-w-5xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500 pb-12">
            <div className="bg-slate-800/50 backdrop-blur-md border border-slate-700 rounded-2xl overflow-hidden shadow-2xl relative">
              <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-tech-accent to-transparent opacity-70"></div>
              <div className="p-8 lg:p-12">
                  <div className="flex flex-col md:flex-row md:items-end justify-between mb-8 border-b border-slate-700 pb-6">
                      <div>
                          <div className="flex items-center mb-2">
                               <span className="bg-tech-accent/10 text-tech-accent border border-tech-accent/20 px-3 py-1 rounded-full font-mono text-xs">ID: {product.id}</span>
                               {product.applicableOccasions && (
                                  <span className="ml-3 text-slate-400 text-xs flex items-center"><Briefcase className="w-3 h-3 mr-1" /> {product.applicableOccasions}</span>
                               )}
                          </div>
                          <h1 className="text-3xl lg:text-5xl font-bold text-white tracking-tight">{product.name}</h1>
                      </div>
                      <div className="mt-4 md:mt-0 text-right">
                          <div className="font-mono text-xs text-slate-500 mb-1">DATA.REF_V2</div>
                      </div>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                      <div className="bg-slate-900/60 p-5 rounded-xl border border-slate-700/50 flex justify-between items-center relative overflow-hidden group">
                         <div className="absolute -right-6 -top-6 bg-emerald-500/10 w-24 h-24 rounded-full blur-xl group-hover:bg-emerald-500/20 transition-all"></div>
                         <div>
                              <div className="flex items-center text-slate-400 mb-1 text-xs uppercase tracking-wider font-semibold"><Tag className="w-4 h-4 mr-2" /> 销售价格</div>
                              <div className="text-3xl font-mono font-bold text-emerald-400">{typeof product.price === 'number' ? '¥' : ''} {product.price}</div>
                         </div>
                      </div>
                      <div className="bg-slate-900/60 p-5 rounded-xl border border-slate-700/50 flex justify-between items-center relative overflow-hidden group">
                         <div className="absolute -right-6 -top-6 bg-sky-500/10 w-24 h-24 rounded-full blur-xl group-hover:bg-sky-500/20 transition-all"></div>
                         <div>
                              <div className="flex items-center text-slate-400 mb-1 text-xs uppercase tracking-wider font-semibold"><DollarSign className="w-4 h-4 mr-2" /> 租赁价格</div>
                              <div className="text-3xl font-mono font-bold text-sky-400">{product.rentalPrice ? product.rentalPrice : 'N/A'}</div>
                         </div>
                      </div>
                  </div>
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                      <div className="space-y-6">
                          {product.parameters && (
                              <div className="bg-slate-900/30 rounded-xl p-5 border border-slate-800">
                                  <div className="flex items-center text-slate-300 font-medium mb-3"><Settings className="w-5 h-5 mr-2 text-tech-accent" /> 产品参数</div>
                                  <p className="text-slate-400 text-sm leading-relaxed whitespace-pre-line font-mono">{product.parameters}</p>
                              </div>
                          )}
                           {product.leadTime && (
                              <div className="bg-slate-900/30 rounded-xl p-5 border border-slate-800 flex items-start">
                                   <Clock className="w-5 h-5 mr-3 text-tech-accent mt-0.5" />
                                   <div><h4 className="text-slate-300 font-medium text-sm mb-1">工期</h4><p className="text-slate-400 text-sm">{product.leadTime}</p></div>
                              </div>
                          )}
                          {product.customerPrep && (
                              <div className="bg-slate-900/30 rounded-xl p-5 border border-slate-800">
                                  <div className="flex items-center text-slate-300 font-medium mb-3"><BoxSelect className="w-5 h-5 mr-2 text-tech-accent" /> 需自备</div>
                                  <p className="text-slate-400 text-sm leading-relaxed whitespace-pre-line">{product.customerPrep}</p>
                              </div>
                          )}
                      </div>
                      <div className="space-y-6">
                           {product.shippingList && (
                              <div>
                                  <div className="flex items-center text-slate-300 font-medium mb-2"><Truck className="w-5 h-5 mr-2 text-tech-accent" /> 发货清单</div>
                                  <div className="pl-7 border-l-2 border-slate-700 ml-2.5">
                                      <p className="text-slate-400 text-sm leading-relaxed whitespace-pre-line pl-4">{product.shippingList}</p>
                                  </div>
                              </div>
                          )}
                          {product.notes && (
                              <div className="bg-amber-900/10 border border-amber-900/30 rounded-lg p-5">
                                  <div className="flex items-center text-amber-400 font-medium mb-2"><AlertCircle className="w-5 h-5 mr-2" /> 注意事项</div>
                                  <p className="text-amber-200/80 text-sm leading-relaxed whitespace-pre-line">{product.notes}</p>
                              </div>
                          )}
                          {product.caseReference && (
                              <div className="pt-4 border-t border-slate-800">
                                   <div className="flex items-center text-slate-400 font-medium mb-2 text-sm"><LinkIcon className="w-4 h-4 mr-2" /> 案例参考</div>
                                  <p className="text-tech-accent text-sm leading-relaxed whitespace-pre-line underline decoration-dashed underline-offset-4">{product.caseReference}</p>
                              </div>
                          )}
                      </div>
                  </div>
                  {product.imageUrl && (
                      <div className="mt-10 pt-10 border-t border-slate-700">
                           <div className="relative group rounded-xl overflow-hidden border border-slate-700 bg-slate-950">
                              <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20 pointer-events-none"></div>
                              <img src={product.imageUrl} alt={product.name} className="w-full h-auto max-h-[600px] object-contain mx-auto" onError={(e) => { e.target.style.display = 'none'; }} />
                               <div className="absolute bottom-4 right-4 bg-black/80 backdrop-blur text-white px-3 py-1 rounded-full text-xs font-mono opacity-0 group-hover:opacity-100 transition-opacity">VISUAL REFERENCE</div>
                          </div>
                      </div>
                  )}
              </div>
            </div>
          </div>
        );
      };

      // --- 6. 组件: ProductForm ---
      const ProductForm = ({ initialData, onSave, onCancel }) => {
        const [formData, setFormData] = useState({
          id: Date.now().toString().slice(-6), name: '', price: '', rentalPrice: '', shippingList: '',
          notes: '', imageUrl: '', parameters: '', leadTime: '', customerPrep: '', caseReference: '', applicableOccasions: ''
        });

        useEffect(() => {
          if (initialData) setFormData(initialData);
          else setFormData({
            id: Date.now().toString().slice(-6), name: '', price: '', rentalPrice: '', shippingList: '',
            notes: '', imageUrl: '', parameters: '', leadTime: '', customerPrep: '', caseReference: '', applicableOccasions: ''
          });
        }, [initialData]);

        const handleChange = (e) => {
          const { name, value } = e.target;
          setFormData(prev => ({ ...prev, [name]: value }));
        };

        const handleSubmit = (e) => {
          e.preventDefault();
          if (!formData.name || !formData.price) { alert('请至少填写产品名称和价格'); return; }
          onSave(formData);
        };

        return (
          <div className="bg-slate-900/50 border border-slate-700 rounded-xl p-6 mb-8 animate-in slide-in-from-top-4 duration-300">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-lg font-bold text-white flex items-center">
                {initialData ? <><Edit2 className="w-5 h-5 mr-2 text-tech-accent" /> 编辑产品信息</> : <><Plus className="w-5 h-5 mr-2 text-tech-accent" /> 手动录入数据</>}
              </h3>
              <button onClick={onCancel} className="text-slate-500 hover:text-white transition-colors"><X className="w-5 h-5" /></button>
            </div>
            <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="space-y-4">
                <div className="grid grid-cols-3 gap-4">
                   <div className="col-span-1"><label className="block text-xs font-mono text-slate-500 mb-1">产品序号 (ID)</label><input name="id" value={formData.id} onChange={handleChange} className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-slate-200 focus:border-tech-accent outline-none font-mono text-sm" /></div>
                   <div className="col-span-2"><label className="block text-xs font-mono text-tech-accent mb-1">* 产品名称</label><input name="name" value={formData.name} onChange={handleChange} placeholder="输入产品名称" className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-white focus:border-tech-accent outline-none" required /></div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div><label className="block text-xs font-mono text-tech-accent mb-1">* 销售价格</label><input name="price" value={formData.price} onChange={handleChange} placeholder="¥0.00" className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-emerald-400 focus:border-tech-accent outline-none font-mono" required /></div>
                  <div><label className="block text-xs font-mono text-slate-500 mb-1">租赁价格</label><input name="rentalPrice" value={formData.rentalPrice} onChange={handleChange} placeholder="¥0.00" className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sky-400 focus:border-tech-accent outline-none font-mono" /></div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div><label className="block text-xs font-mono text-slate-500 mb-1">工期</label><input name="leadTime" value={formData.leadTime} onChange={handleChange} placeholder="例如: 3-5天" className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-slate-300 focus:border-tech-accent outline-none" /></div>
                  <div><label className="block text-xs font-mono text-slate-500 mb-1">适用场合</label><input name="applicableOccasions" value={formData.applicableOccasions} onChange={handleChange} placeholder="例如: 户外, 婚礼" className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-slate-300 focus:border-tech-accent outline-none" /></div>
                </div>
                <div><label className="block text-xs font-mono text-slate-500 mb-1">图片链接 (URL)</label><input name="imageUrl" value={formData.imageUrl} onChange={handleChange} placeholder="https://..." className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-slate-400 focus:border-tech-accent outline-none" /></div>
                 <div><label className="block text-xs font-mono text-slate-500 mb-1">案例参考</label><textarea name="caseReference" value={formData.caseReference} onChange={handleChange} rows={2} placeholder="相关案例链接或描述..." className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-slate-300 focus:border-tech-accent outline-none resize-none" /></div>
              </div>
              <div className="space-y-4">
                <div><label className="block text-xs font-mono text-slate-500 mb-1">产品参数</label><textarea name="parameters" value={formData.parameters} onChange={handleChange} rows={3} placeholder="尺寸, 材质, 功率等详细参数..." className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-slate-300 focus:border-tech-accent outline-none resize-none" /></div>
                 <div><label className="block text-xs font-mono text-slate-500 mb-1">需自备</label><textarea name="customerPrep" value={formData.customerPrep} onChange={handleChange} rows={2} placeholder="客户需要准备的条件..." className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-slate-300 focus:border-tech-accent outline-none resize-none" /></div>
                 <div><label className="block text-xs font-mono text-slate-500 mb-1">发货清单</label><textarea name="shippingList" value={formData.shippingList} onChange={handleChange} rows={3} placeholder="列出包含的配件..." className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-slate-300 focus:border-tech-accent outline-none resize-none" /></div>
                <div><label className="block text-xs font-mono text-slate-500 mb-1">注意事项</label><textarea name="notes" value={formData.notes} onChange={handleChange} rows={2} placeholder="需要注意的事项..." className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-amber-200/80 focus:border-tech-accent outline-none resize-none" /></div>
                <div className="flex justify-end pt-2">
                  <button type="submit" className="bg-tech-accent hover:bg-cyan-400 text-slate-900 font-bold py-2 px-6 rounded-lg transition-colors flex items-center"><Save className="w-4 h-4 mr-2" /> {initialData ? '更新数据' : '保存数据'}</button>
                </div>
              </div>
            </form>
          </div>
        );
      };

      // --- 7. 组件: ProductList ---
      const ProductList = ({ products, onDelete, onEdit }) => {
        if (products.length === 0) return null;
        return (
          <div className="w-full bg-slate-900 border border-slate-800 rounded-xl overflow-hidden shadow-lg animate-in fade-in duration-500">
            <div className="overflow-x-auto">
              <table className="w-full text-left text-sm">
                <thead className="bg-slate-950 text-slate-400 font-mono text-xs uppercase">
                  <tr>
                    <th className="px-6 py-4">序号</th><th className="px-6 py-4">产品名称</th><th className="px-6 py-4">销售价格</th><th className="px-6 py-4">租赁价格</th><th className="px-6 py-4">工期</th><th className="px-6 py-4 text-center">图片</th><th className="px-6 py-4 text-right">操作</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-slate-800/50">
                  {products.map((product, index) => (
                    <tr key={`${product.id}-${index}`} className="group hover:bg-slate-800/50 transition-colors">
                      <td className="px-6 py-4 font-mono text-slate-500">{product.id}</td>
                      <td className="px-6 py-4 font-medium text-slate-200">{product.name}</td>
                      <td className="px-6 py-4 font-mono text-emerald-400">{product.price}</td>
                      <td className="px-6 py-4 font-mono text-sky-400">{product.rentalPrice || '-'}</td>
                      <td className="px-6 py-4 text-slate-400 text-xs">{product.leadTime || '-'}</td>
                      <td className="px-6 py-4 text-center">{product.imageUrl ? <Image className="w-4 h-4 text-slate-400 mx-auto" /> : <span className="text-slate-700">-</span>}</td>
                      <td className="px-6 py-4 text-right">
                        <div className="flex items-center justify-end space-x-2">
                          <button onClick={() => onEdit(product)} className="text-slate-600 hover:text-tech-accent transition-colors p-1" title="编辑"><Edit className="w-4 h-4" /></button>
                          <button onClick={() => onDelete(product.id)} className="text-slate-600 hover:text-red-400 transition-colors p-1" title="删除"><Trash2 className="w-4 h-4" /></button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <div className="bg-slate-950 px-6 py-3 border-t border-slate-800 text-right"><span className="text-xs font-mono text-slate-500">共加载 {products.length} 条数据</span></div>
          </div>
        );
      };

      // --- 8. 主应用: App ---
      const App = () => {
        const [products, setProducts] = useState([]);
        const [selectedProduct, setSelectedProduct] = useState(null);
        const [dataLoaded, setDataLoaded] = useState(false);
        const [viewMode, setViewMode] = useState('search');
        const [showManualForm, setShowManualForm] = useState(false);
        const [editingProduct, setEditingProduct] = useState(null);

        useEffect(() => {
          const savedData = localStorage.getItem('nexus_products');
          if (savedData) {
            try {
              const parsed = JSON.parse(savedData);
              if (Array.isArray(parsed) && parsed.length > 0) {
                setProducts(parsed);
                setDataLoaded(true);
              }
            } catch (e) { console.error("Corrupt local storage data"); }
          }
        }, []);

        const updateProducts = (newProducts) => {
          setProducts(newProducts);
          localStorage.setItem('nexus_products', JSON.stringify(newProducts));
          setDataLoaded(newProducts.length > 0);
        };

        const handleDataImported = (data) => updateProducts([...data, ...products]);
        
        const handleSaveProduct = (product) => {
          if (editingProduct) updateProducts(products.map(p => p.id === editingProduct.id ? product : p));
          else updateProducts([product, ...products]);
          setEditingProduct(null);
          setShowManualForm(false);
        };

        const handleEditClick = (product) => {
          setEditingProduct(product);
          setShowManualForm(true);
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const handleDelete = (id) => {
          if (window.confirm('确认删除此条目吗？')) updateProducts(products.filter(p => p.id !== id));
        };

        return (
          <div className="min-h-screen bg-[#0f172a] bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-[#0f172a] to-black text-slate-200 font-sans selection:bg-tech-accent selection:text-slate-900 overflow-x-hidden">
            <div className="fixed inset-0 z-0 pointer-events-none opacity-20" style={{ backgroundImage: 'linear-gradient(#334155 1px, transparent 1px), linear-gradient(90deg, #334155 1px, transparent 1px)', backgroundSize: '40px 40px' }}></div>
            <div className="relative z-10 container mx-auto px-4 py-8 flex flex-col items-center min-h-screen">
              <header className="w-full max-w-6xl flex items-center justify-between mb-8 border-b border-slate-800 pb-6">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 bg-tech-accent rounded-lg flex items-center justify-center shadow-[0_0_15px_rgba(6,182,212,0.5)]"><Zap className="text-slate-900 w-6 h-6 fill-current" /></div>
                  <div><h1 className="text-2xl font-bold tracking-tight text-white">MINDYN</h1><p className="text-[10px] font-mono text-tech-accent tracking-[0.2em] uppercase">智能价格查询系统</p></div>
                </div>
                <div className="flex items-center space-x-4">
                   {dataLoaded && <div className="hidden md:flex items-center px-4 py-2 bg-slate-800/50 rounded-full border border-slate-700"><Database className="w-4 h-4 text-emerald-400 mr-2" /><span className="text-xs font-mono text-slate-300">数据库: {products.length} 条记录</span></div>}
                </div>
              </header>

              <nav className="flex space-x-2 bg-slate-900/50 p-1 rounded-xl border border-slate-800 mb-8">
                <button onClick={() => { setViewMode('search'); setShowManualForm(false); setEditingProduct(null); }} className={`flex items-center px-6 py-2 rounded-lg text-sm font-medium transition-all duration-300 ${viewMode === 'search' ? 'bg-tech-accent text-slate-900 shadow-lg' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`}><Search className="w-4 h-4 mr-2" /> 产品查询</button>
                <button onClick={() => setViewMode('manage')} className={`flex items-center px-6 py-2 rounded-lg text-sm font-medium transition-all duration-300 ${viewMode === 'manage' ? 'bg-tech-accent text-slate-900 shadow-lg' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`}><Settings className="w-4 h-4 mr-2" /> 数据管理</button>
              </nav>

              <main className="w-full max-w-6xl flex flex-col items-center flex-grow">
                {viewMode === 'search' ? (
                  <div className="w-full flex flex-col items-center animate-in fade-in duration-300">
                     {dataLoaded ? (
                       <>
                        <div className="mb-12 w-full flex justify-center"><SearchBar products={products} onProductSelect={setSelectedProduct} /></div>
                        {selectedProduct ? <ProductDetail product={selectedProduct} /> : <div className="w-full max-w-4xl border border-dashed border-slate-800 rounded-2xl h-64 flex flex-col items-center justify-center text-slate-600 animate-in zoom-in-95 duration-500"><LayoutGrid className="w-12 h-12 mb-4 opacity-50" /><p className="font-mono text-sm">等待输入指令...</p><p className="text-xs text-slate-700 mt-2">请在上方搜索栏输入关键词</p></div>}
                       </>
                     ) : (
                       <div className="text-center mt-20"><h2 className="text-xl text-slate-400 mb-4">系统暂无数据</h2><button onClick={() => setViewMode('manage')} className="px-6 py-3 bg-slate-800 hover:bg-slate-700 text-tech-accent rounded-xl border border-tech-accent/30 transition-all">前往数据管理导入数据</button></div>
                     )}
                  </div>
                ) : (
                  <div className="w-full flex flex-col items-center animate-in slide-in-from-right-8 duration-300">
                    <div className="w-full grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                      <div className="md:col-span-2"><div className="bg-slate-900/50 border border-slate-800 p-6 rounded-xl h-full flex items-center"><FileUpload onDataLoaded={handleDataImported} /></div></div>
                      <div className="bg-slate-900/50 border border-slate-800 p-6 rounded-xl flex flex-col justify-center items-center text-center">
                        <h3 className="text-slate-200 font-bold mb-2">手动录入</h3><p className="text-slate-500 text-xs mb-4">单个添加或编辑产品</p>
                        <button onClick={() => { setShowManualForm(!showManualForm); setEditingProduct(null); }} className="w-full py-3 bg-slate-800 hover:bg-tech-accent hover:text-slate-900 border border-slate-700 rounded-lg text-slate-300 transition-all flex items-center justify-center font-medium"><PlusCircle className="w-5 h-5 mr-2" />{showManualForm && !editingProduct ? '取消录入' : '新增产品'}</button>
                      </div>
                    </div>
                    {showManualForm && <div className="w-full"><ProductForm initialData={editingProduct} onSave={handleSaveProduct} onCancel={() => { setShowManualForm(false); setEditingProduct(null); }} /></div>}
                    <div className="w-full"><div className="flex items-center justify-between mb-4 px-2"><h3 className="text-lg font-bold text-white flex items-center"><Database className="w-5 h-5 mr-2 text-tech-accent" /> 数据预览</h3><span className="text-xs font-mono text-slate-500">最新录入优先</span></div><ProductList products={products} onDelete={handleDelete} onEdit={handleEditClick} /></div>
                  </div>
                )}
              </main>
              <footer className="w-full text-center py-8 text-slate-600 text-xs font-mono mt-auto"><p>MINDYN SYSTEMS V1.5 // CN_LOCALE // SECURE</p></footer>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>
